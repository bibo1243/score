<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>員工績效考核自動分析系統</title>
    <style>
        :root {
            --bg-dark: #1a1a2e;
            --bg-card: #16213e;
            --primary: #667eea;
            --secondary: #764ba2;
            --text-main: #e8e8e8;
            --text-sub: #b0b0b0;
        }

        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.2), rgba(118, 75, 162, 0.2));
            padding: 30px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header h1 {
            margin: 0 0 10px 0;
            color: var(--primary);
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: none;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: 0.3s;
        }

        .tab.active {
            background: var(--primary);
        }

        .tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.2);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-card);
            border-radius: 10px;
            overflow: hidden;
            font-size: 0.9em;
        }

        th,
        td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        th {
            background: rgba(0, 0, 0, 0.3);
            font-weight: bold;
            color: var(--primary);
        }

        tr:hover {
            background: rgba(255, 255, 255, 0.02);
        }

        .score-box {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.1);
            min-width: 40px;
            text-align: center;
        }

        .total-score {
            font-weight: bold;
            color: #4facfe;
        }

        .tag {
            font-size: 0.8em;
            padding: 2px 6px;
            border-radius: 4px;
            margin-right: 4px;
            opacity: 0.8;
        }

        .role-mgr {
            background: #d32f2f;
        }

        .role-senior {
            background: #f57c00;
        }

        .role-gen {
            background: #388e3c;
        }

        .rule-info {
            font-size: 0.8em;
            color: var(--text-sub);
            margin-top: 4px;
        }

        .category-score {
            font-size: 0.9em;
            color: #aaa;
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>績效考核自動分析系統 (114下)</h1>
            <p>包含 13 條自動化加權規則計算</p>
        </div>

        <div class="tabs" id="unitTabs">
            <button class="tab active" onclick="renderTable('all')">全部總覽</button>
        </div>

        <div id="content">
            <table id="mainTable">
                <thead>
                    <tr>
                        <th>單位</th>
                        <th>姓名</th>
                        <th>職稱</th>
                        <th>考核規則</th>
                        <th>評分來源分析 (加權計算)</th>
                        <th>第一類(40)</th>
                        <th>第二類(30)</th>
                        <th>第三類(30)</th>
                        <th>加權總分</th>
                    </tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        // 資料區塊 (稍後注入)
        const RAW_PERSONNEL_CSV = `所屬機構,所屬單位,股別,直屬主管,職稱,考核標準,員工姓名
基金會,行政組,,董事長,總幹事,主管,李冠葦
行政組,行政組,,行政組長,副組長,主管,陳淑錡
行政組,行政組,庶務股,行政組長,股長,主管,林紀騰
基金會,會計室,,總幹事,組員,資深員工,李鳳翎
行政組,行政組,出納股,行政組長,股員,資深員工,王芊蓉
行政組,行政組,資訊股,行政組長,股員,資深員工,王元鼎
行政組,行政組,庶務股,股長,股員,資深員工,林港博
行政組,行政組,庶務股,股長,股員,一般員工,謝秀桃
行政組,行政組,庶務股,股長,股員,一般員工,徐銘澤
行政組,行政組,庶務股,股長,股員,一般員工,羅如光
行政組,行政組,出納股,行政組長,股員,一般員工,陸廷瑋
行政組,行政組,文書股,行政組長,股員,一般員工,林麗娟
基金會,圖書組,,總幹事,組長,主管,高靜華
基金會,社資組,,總幹事,組員,一般員工,王姿斐
基金會,人資公關組,,總幹事,組長,主管,白梅芳
-,兒少之家,,董事長,主任,主管,廖振杉
基金會,行政組,膳務股,兒家主任,膳務股員,一般員工,熊小蓮
教保組,行政組,社工股,兒家教保組長,社工督導,主管,簡采琦
兒少之家,教保組,,兒家主任,兒家教保組長,主管,陳宛妤
教保組,教保組,保育股,兒家教保組長,保育生輔員,資深員工,林東美
教保組,教保組,保育股,兒家教保組長,保育生輔員,資深員工,賀郁茵
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,梁偉培
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,廖玟慈
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,張宜芳
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,蕭婷予
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,王卉蓁
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,陳亮寧
教保組,教保組,社工股,兒家教保組長,保育生輔員,一般員工,曾婷婷
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,李炎輝
教保組,教保組,保育股,兒家教保組長,保育生輔員,一般員工,許芸嘉
-,少年家園,,董事長,主任,主管,廖慧雯
基金會,行政組,膳務股,行政組長,股員,一般員工,劉春燕
少年家園,教保組,社工心輔股,社工督導,股員,資深員工,蘇盟惠
少年家園,教保組,社工心輔股,社工督導,股員,資深員工,劉宛宣
少年家園,教保組,,少家主任,教保組長,主管,鍾宜珮
少年家園,教保組,生輔股,教保組長,生輔督導,主管,林品亨
少年家園,教保組,生輔股,生輔督導,股員,資深員工,胡少淇
少年家園,教保組,生輔股,生輔督導,股員,資深員工,郭楷欣
少年家園,教保組,生輔股,生輔督導,股員,資深員工,吳秉熹
少年家園,教保組,生輔股,生輔督導,股員,一般員工,蔣郡哲
少年家園,教保組,生輔股,生輔督導,股員,一般員工,劉婷瑜
少年家園,教保組,生輔股,生輔督導,股員,一般員工,黃穎蓁
少年家園,教保組,生輔股,生輔督導,股員,一般員工,吳思函
少年家園,教保組,生輔股,生輔督導,股員,一般員工,陳昱綸
少年家園,教保組,社工心輔股,社工督導,股員,一般員工,黃歆藝
諮商所,,,董事長,所長,主管,楊顗帆
諮商所,,,所長,社工員,資深員工,陳柔安
諮商所,,,所長,社工員,一般員工,林彥秀`;
        let RAW_SCORE_CSV = `建立時間,評分者,受評者 ,第一大類（共40分）,第二大類（共30分）,第三大類（共30分）,總分 
2025/12/25 上午 12:44,林紀騰,王元鼎,36,25,24,85
2025/12/25 上午 12:45,林紀騰,李鳳翎,32,25,25,82
2025/12/25 上午 12:47,林紀騰,王芊蓉,32,24,24,80
2025/12/25 上午 12:48,林紀騰,林港博,32,23,23,78
2025/12/25 下午 07:10,林東美,賀郁茵,36,20,24,80
2025/12/26 上午 06:17,胡少淇,蘇盟惠,34,24,25,83
2025/12/26 上午 06:18,胡少淇,郭楷欣,35,25,27,87
2025/12/26 上午 06:19,胡少淇,劉宛宣,33,24,24,81
2025/12/26 上午 06:20,胡少淇,吳秉熹,34,24,26,84
2025/12/26 下午 02:28,林港博,王芊蓉,33,25,27,85
2025/12/26 下午 02:38,林港博,李鳳翎,36,25,27,88
2025/12/26 下午 02:40,林港博,王元鼎,40,29,27,96
2025/12/26 下午 06:56,吳秉熹,蘇盟惠,36,25,26,87
2025/12/26 下午 07:01,吳秉熹,郭楷欣,36,24,27,87
2025/12/26 下午 07:03,吳秉熹,劉宛宣,33,25,27,85
2025/12/26 下午 07:05,吳秉熹,胡少淇,32,25,24,81
2025/12/27 上午 01:20,廖慧雯,蘇盟惠,30,23,22,75
2025/12/27 上午 01:21,廖慧雯,郭楷欣,35,27,28,90
2025/12/27 上午 01:22,廖慧雯,劉宛宣,36,26,28,90
2025/12/27 上午 01:23,廖慧雯,吳秉熹,35,26,27,88
2025/12/27 上午 01:24,廖慧雯,胡少淇,26,22,24,72
2025/12/27 上午 02:04,鍾宜珮,蘇盟惠,27,17,22,66
2025/12/27 上午 02:05,鍾宜珮,郭楷欣,33,24,26,83
2025/12/27 上午 02:06,鍾宜珮,劉宛宣,34,22,25,81
2025/12/27 上午 02:07,鍾宜珮,吳秉熹,30,22,24,76
2025/12/27 上午 02:08,鍾宜珮,胡少淇,25,16,19,60
2025/12/27 下午 04:56,劉宛宣,蘇盟惠,29,23,18,70
2025/12/27 下午 05:07,劉宛宣,郭楷欣,30,24,23,77
2025/12/27 下午 05:13,劉宛宣,吳秉熹,32,25,24,81
2025/12/27 下午 05:15,劉宛宣,胡少淇,26,18,16,60
2025/12/27 下午 09:10,楊顗帆,陳柔安,35,27,25,87
2025/12/27 下午 10:10,林品亨,蘇盟惠,31,21,23,75
2025/12/28 上午 02:42,李冠葦,林港博,27,27,27,81
2025/12/28 上午 04:27,郭楷欣,胡少淇,31,19,24,74
2025/12/28 下午 09:59,李冠葦,王芊蓉,33,25,25,83
2025/12/28 下午 10:00,李冠葦,李鳳翎,38,27,28,93
2025/12/28 下午 10:37,李冠葦,王元鼎,37,28,25,90
2025/12/28 下午 11:53,郭楷欣,吳秉熹,31,23,23,77
2025/12/29 上午 12:23,郭楷欣,劉宛宣,33,20,25,78
2025/12/29 上午 12:26,郭楷欣,蘇盟惠,30,23,22,75
2025/12/29 上午 01:21,李鳳翎,林港博,35,27,27,89
2025/12/29 上午 01:23,李鳳翎,王元鼎,39,29,28,96
2025/12/29 上午 01:23,李鳳翎,王芊蓉,36,27,27,90
2025/12/29 上午 01:25,李鳳翎,林紀騰,37,28,29,94
2025/12/29 下午 07:45,王元鼎,林紀騰,37,29,29,95
2025/12/29 下午 07:47,王元鼎,王芊蓉,34,25,26,85
2025/12/29 下午 07:50,王元鼎,李鳳翎,35,29,30,94
2025/12/29 下午 09:59,王元鼎,林港博,31,28,25,84
2025/12/29 下午 10:03,蘇盟惠,劉宛宣,31,21,24,76
2025/12/29 下午 10:06,蘇盟惠,郭楷欣,33,20,24,77
2025/12/29 下午 10:15,蘇盟惠,吳秉熹,29,21,23,73
2025/12/29 下午 10:17,蘇盟惠,胡少淇,28,20,23,71
2025/12/29 下午 10:55,簡采琦,林東美,36,27,27,90
2025/12/29 下午 10:56,簡采琦,賀郁茵,37,25,28,90
2025/12/29 下午 11:43,陳淑錡,王芊蓉,21,20,23,64
2025/12/29 下午 11:46,陳淑錡,李鳳翎,24,25,24,73
2025/12/29 下午 11:56,陳淑錡,王元鼎,34,25,21,80
2025/12/30 上午 12:03,陳淑錡,林港博,22,20,18,60
2025/12/30 上午 01:31,王芊蓉,林紀騰,34,27,24,85
2025/12/30 上午 01:34,王芊蓉,李鳳翎,35,28,25,88
2025/12/30 上午 01:37,王芊蓉,王元鼎,36,27,25,88
2025/12/30 上午 01:39,王芊蓉,林港博,34,27,24,85
2025/12/30 上午 10:48,賀郁茵,林東美,36,27,27,90
2025/12/30 下午 01:41,林品亨,郭楷欣,33,26,25,84
2025/12/30 下午 01:45,林品亨,劉宛宣,35,21,25,81
2025/12/30 下午 10:04,陳宛妤,林東美,34,24,22,80
2025/12/30 下午 10:06,陳宛妤,賀郁茵,33,23,24,80
2025/12/30 下午 10:24,林品亨,吳秉熹,29,23,21,73
2025/12/30 下午 10:29,林品亨,胡少淇,28,19,21,68
2025/12/31 上午 12:00,廖振杉,林東美,34,25,25,84
2025/12/31 上午 12:02,廖振杉,賀郁茵,34,25,26,85
2025/12/18 上午 04:25,林港博,謝秀桃,28,18,17,63
2025/12/18 上午 04:27,林港博,羅如光,32,21,27,80
2025/12/18 上午 04:29,林港博,劉春燕,37,24,25,86
2025/12/18 上午 04:30,林港博,熊小蓮,33,25,25,83
2025/12/18 上午 04:34,林港博,陸廷瑋,38,24,27,89
2025/12/18 上午 04:37,林港博,林麗娟,33,25,26,84
2025/12/18 上午 04:40,林港博,王姿斐,40,28,28,96
2025/12/21 上午 12:58,黃歆藝,郭楷欣,32,24,25,81
2025/12/21 上午 01:07,黃歆藝,胡少淇,26,22,22,70
2025/12/21 上午 01:06,黃歆藝,吳秉熹,35,28,26,89
2025/12/21 上午 01:13,黃歆藝,蔣郡哲,33,25,26,84
2025/12/21 上午 01:14,黃歆藝,劉婷瑜,35,27,27,89
2025/12/21 上午 01:15,黃歆藝,吳思函,34,27,26,87
2025/12/21 上午 01:52,黃歆藝,蘇盟惠,35,22,27,84
2025/12/21 上午 01:48,黃歆藝,劉宛宣,36,29,28,93
2025/12/21 上午 01:52,黃歆藝,黃穎蓁,36,26,28,90
2025/12/30 下午 09:19,黃穎蓁,黃歆藝,33,24,23,80
2025/12/30 下午 09:18,黃穎蓁,劉宛宣,35,24,25,84
2025/12/21 下午 04:34,熊小蓮,林紀騰,28,23,22,73
2025/12/21 下午 04:36,熊小蓮,王芊蓉,36,29,26,91
2025/12/21 下午 04:38,熊小蓮,李鳳翎,38,27,27,92
2025/12/21 下午 04:39,熊小蓮,王元鼎,38,26,27,91
2025/12/21 下午 04:40,熊小蓮,林港博,38,27,25,90
2025/12/21 下午 04:41,熊小蓮,謝秀桃,27,23,23,73
2025/12/21 下午 04:42,熊小蓮,羅如光,24,22,21,67
2025/12/21 下午 04:43,熊小蓮,劉春燕,34,26,26,86
2025/12/21 下午 04:45,熊小蓮,陸廷瑋,33,26,26,85
2025/12/21 下午 04:46,熊小蓮,林麗娟,34,24,27,85
2025/12/22 下午 09:46,陳柔安,林彥秀,38,26,27,91
2025/12/23 上午 12:35,陸廷瑋,林紀騰,34,28,27,89
2025/12/28 上午 12:17,陸廷瑋,王芊蓉,31,26,24,81
2025/12/23 上午 12:40,陸廷瑋,李鳳翎,37,27,28,92
2025/12/23 上午 12:41,陸廷瑋,王元鼎,38,28,28,94
2025/12/23 上午 12:44,陸廷瑋,林港博,27,24,27,78
2025/12/23 上午 12:47,陸廷瑋,謝秀桃,21,19,20,60
2025/12/23 上午 12:48,陸廷瑋,羅如光,19,18,23,60
2025/12/23 上午 12:50,陸廷瑋,劉春燕,32,26,25,83
2025/12/23 上午 12:53,陸廷瑋,熊小蓮,27,21,22,70
2025/12/23 上午 12:55,陸廷瑋,林麗娟,33,26,25,84
2025/12/23 上午 12:57,陸廷瑋,王姿斐,37,26,27,90
2025/12/23 上午 04:13,蕭婷予,林東美,39,30,30,99
2025/12/24 上午 09:22,王卉蓁,林東美,37,26,28,91
2025/12/24 上午 09:24,王卉蓁,賀郁茵,38,27,26,91
2025/12/24 上午 09:38,王卉蓁,梁偉培,35,25,23,83
2025/12/24 上午 09:26,王卉蓁,廖玟慈,37,24,27,88
2025/12/24 上午 09:28,王卉蓁,張宜芳,30,21,22,73
2025/12/24 上午 09:30,王卉蓁,蕭婷予,33,25,25,83
2025/12/24 上午 09:36,王卉蓁,陳亮寧,34,23,24,81
2025/12/24 上午 09:33,王卉蓁,李炎輝,32,22,21,75
2025/12/24 上午 09:36,王卉蓁,許芸嘉,33,23,24,80
2025/12/24 上午 09:37,王卉蓁,曾婷婷,34,24,23,81
2025/12/24 下午 10:35,鍾宜珮,蔣郡哲,28,21,19,68
2025/12/24 下午 10:37,鍾宜珮,劉婷瑜,33,24,23,80
2025/12/30 上午 12:30,鍾宜珮,吳思函,35,23,25,83
2025/12/29 上午 12:43,林紀騰,陸廷瑋,35,25,23,83
2025/12/29 上午 12:44,林紀騰,王姿斐,36,24,25,85
2025/12/25 上午 12:09,林紀騰,林麗娟,33,25,25,83
2025/12/25 上午 12:10,林紀騰,劉春燕,34,25,25,84
2025/12/25 上午 12:11,林紀騰,熊小蓮,28,23,21,72
2025/12/25 上午 12:15,林紀騰,謝秀桃,24,20,19,63
2025/12/25 上午 12:14,林紀騰,羅如光,26,20,20,66
2025/12/25 下午 06:58,林東美,梁偉培,38,29,28,95
2025/12/25 下午 06:58,林東美,廖玟慈,40,30,30,100
2025/12/25 下午 07:01,林東美,張宜芳,28,23,22,73
2025/12/25 下午 07:02,林東美,蕭婷予,33,27,26,86
2025/12/25 下午 07:04,林東美,陳亮寧,39,26,27,92
2025/12/25 下午 07:05,林東美,王卉蓁,37,27,28,92
2025/12/25 下午 07:07,林東美,李炎輝,34,25,26,85
2025/12/25 下午 07:09,林東美,許芸嘉,38,29,27,94
2025/12/25 下午 07:10,林東美,曾婷婷,37,29,28,94
2025/12/25 下午 11:24,簡采琦,梁偉培,35,28,25,88
2025/12/26 下午 10:48,蕭婷予,賀郁茵,40,30,29,99
2025/12/26 下午 10:50,蕭婷予,梁偉培,39,30,28,97
2025/12/26 上午 06:14,胡少淇,蔣郡哲,31,20,24,75
2025/12/26 上午 06:14,胡少淇,劉婷瑜,36,27,28,91
2025/12/26 上午 06:15,胡少淇,吳思函,35,26,27,88
2025/12/26 上午 06:16,胡少淇,黃穎蓁,36,28,28,92
2025/12/26 上午 06:17,胡少淇,黃歆藝,35,25,25,85
2025/12/26 下午 07:08,吳秉熹,蔣郡哲,36,25,25,86
2025/12/26 下午 07:08,吳秉熹,劉婷瑜,36,26,25,87
2025/12/26 下午 07:09,吳秉熹,吳思函,36,25,25,86
2025/12/26 下午 07:09,吳秉熹,黃穎蓁,36,25,25,86
2025/12/26 下午 07:10,吳秉熹,黃歆藝,36,25,25,86
2025/12/26 下午 10:40,蕭婷予,廖玟慈,40,30,30,100
2025/12/26 下午 10:41,蕭婷予,陳亮寧,39,28,30,97
2025/12/26 下午 10:51,蕭婷予,張宜芳,37,28,30,95
2025/12/26 下午 10:43,蕭婷予,王卉蓁,39,30,30,99
2025/12/26 下午 10:44,蕭婷予,李炎輝,37,30,29,96
2025/12/26 下午 10:45,蕭婷予,許芸嘉,36,29,30,95
2025/12/26 下午 10:46,蕭婷予,曾婷婷,40,29,29,98
2025/12/27 上午 12:40,廖慧雯,蔣郡哲,32,24,24,80
2025/12/27 上午 12:41,廖慧雯,劉婷瑜,37,28,26,91
2025/12/27 上午 12:42,廖慧雯,吳思函,38,26,28,92
2025/12/27 上午 12:44,廖慧雯,黃穎蓁,34,27,27,88
2025/12/27 上午 12:45,廖慧雯,黃歆藝,37,29,25,91
2025/12/27 上午 12:47,廖慧雯,劉春燕,36,26,24,86
2025/12/27 上午 02:03,鍾宜珮,黃穎蓁,32,24,24,80
2025/12/27 上午 02:04,鍾宜珮,黃歆藝,33,22,22,77
2025/12/27 上午 09:27,陳亮寧,林東美,39,28,29,96
2025/12/27 上午 09:28,陳亮寧,賀郁茵,36,30,30,96
2025/12/27 上午 09:29,陳亮寧,梁偉培,35,27,28,90
2025/12/27 上午 09:30,陳亮寧,廖玟慈,40,28,30,98
2025/12/27 上午 09:36,陳亮寧,張宜芳,32,25,30,87
2025/12/27 上午 09:31,陳亮寧,蕭婷予,38,29,28,95
2025/12/27 上午 09:32,陳亮寧,王卉蓁,39,29,28,96
2025/12/27 上午 09:33,陳亮寧,李炎輝,37,28,25,90
2025/12/27 上午 09:36,陳亮寧,許芸嘉,38,29,28,95
2025/12/27 上午 09:38,陳亮寧,曾婷婷,39,28,29,96
2025/12/27 下午 03:40,李炎輝,梁偉培,40,30,30,100
2025/12/27 下午 03:42,李炎輝,林東美,40,30,30,100
2025/12/27 下午 03:42,李炎輝,賀郁茵,40,30,30,100
2025/12/27 下午 03:43,李炎輝,廖玟慈,40,30,30,100
2025/12/27 下午 03:44,李炎輝,蕭婷予,38,30,30,98
2025/12/27 下午 03:45,李炎輝,陳亮寧,38,30,30,98
2025/12/27 下午 03:45,李炎輝,曾婷婷,38,30,30,98
2025/12/27 下午 03:46,李炎輝,許芸嘉,38,30,30,98
2025/12/27 下午 03:47,李炎輝,王卉蓁,38,30,30,98
2025/12/27 下午 03:50,李炎輝,張宜芳,32,22,19,73
2025/12/27 下午 05:38,劉宛宣,蔣郡哲,31,24,23,78
2025/12/27 下午 05:38,劉宛宣,劉婷瑜,35,24,25,84
2025/12/27 下午 05:39,劉宛宣,吳思函,36,24,25,85
2025/12/27 下午 05:39,劉宛宣,黃穎蓁,35,24,25,84
2025/12/27 下午 05:40,劉宛宣,黃歆藝,35,24,25,84
2025/12/27 下午 06:42,曾婷婷,林東美,40,30,30,100
2025/12/27 下午 06:43,曾婷婷,賀郁茵,39,28,30,97
2025/12/28 上午 06:28,曾婷婷,梁偉培,38,28,25,91
2025/12/27 下午 07:26,楊顗帆,林彥秀,37,27,26,90
2025/12/27 下午 10:10,林品亨,蔣郡哲,32,21,27,80
2025/12/27 下午 10:08,廖慧雯,陳昱綸,38,26,26,90
2025/12/27 下午 11:17,黃歆藝,陳昱綸,31,24,25,80
2025/12/28 上午 01:36,劉宛宣,陳昱綸,34,24,25,83
2025/12/28 上午 02:31,李冠葦,謝秀桃,24,19,17,60
2025/12/28 上午 02:36,李冠葦,羅如光,26,18,22,66
2025/12/28 上午 03:36,郭楷欣,蔣郡哲,36,23,25,84
2025/12/28 上午 03:44,郭楷欣,劉婷瑜,36,26,26,88
2025/12/28 上午 03:46,郭楷欣,吳思函,34,26,26,86
2025/12/28 上午 03:49,郭楷欣,陳昱綸,34,25,22,81
2025/12/28 上午 03:56,郭楷欣,黃穎蓁,36,27,25,88
2025/12/28 下午 11:52,郭楷欣,黃歆藝,37,28,28,93
2025/12/28 上午 04:12,林品亨,劉婷瑜,35,24,30,89
2025/12/29 上午 06:43,林品亨,吳思函,35,23,29,87
2025/12/28 上午 06:22,曾婷婷,廖玟慈,40,28,28,96
2025/12/28 上午 06:26,曾婷婷,張宜芳,33,24,26,83
2025/12/28 上午 06:27,曾婷婷,蕭婷予,33,29,29,91
2025/12/28 上午 06:30,曾婷婷,陳亮寧,36,28,28,92
2025/12/28 上午 07:02,曾婷婷,王卉蓁,37,30,29,96
2025/12/28 下午 08:21,曾婷婷,李炎輝,36,30,28,94
2025/12/28 上午 07:24,胡少淇,陳昱綸,35,25,26,86
2025/12/28 下午 11:53,陳昱綸,蔣郡哲,35,26,27,88
2025/12/28 下午 11:52,陳昱綸,劉婷瑜,36,25,27,88
2025/12/28 上午 07:54,陳昱綸,吳思函,35,25,25,85
2025/12/28 上午 07:56,陳昱綸,黃歆藝,33,25,23,81
2025/12/28 上午 07:58,陳昱綸,郭楷欣,34,28,30,92
2025/12/28 上午 07:59,陳昱綸,胡少淇,31,26,23,80
2025/12/28 上午 08:00,陳昱綸,吳秉熹,37,25,26,88
2025/12/28 上午 08:01,陳昱綸,蘇盟惠,37,30,27,94
2025/12/28 上午 08:02,陳昱綸,劉宛宣,37,27,27,91
2025/12/28 上午 08:03,陳昱綸,黃穎蓁,33,26,25,84
2025/12/28 上午 08:17,蔣郡哲,黃歆藝,34,26,24,84
2025/12/28 上午 08:18,蔣郡哲,黃穎蓁,33,24,23,80
2025/12/28 上午 08:19,蔣郡哲,劉宛宣,35,21,27,83
2025/12/28 上午 08:20,蔣郡哲,蘇盟惠,36,26,23,85
2025/12/28 上午 08:21,蔣郡哲,陳昱綸,27,15,23,65
2025/12/28 上午 08:22,蔣郡哲,吳思函,35,24,25,84
2025/12/28 上午 08:23,蔣郡哲,劉婷瑜,37,24,24,85
2025/12/28 上午 08:24,蔣郡哲,吳秉熹,36,24,25,85
2025/12/28 上午 08:25,蔣郡哲,胡少淇,27,24,18,69
2025/12/28 上午 08:26,蔣郡哲,郭楷欣,31,22,27,80
2025/12/28 下午 07:29,王元鼎,謝秀桃,26,26,21,73
2025/12/28 下午 05:29,李鳳翎,謝秀桃,32,25,23,80
2025/12/28 下午 05:43,林彥秀,陳柔安,38,30,28,96
2025/12/28 下午 06:54,李冠葦,王姿斐,36,27,27,90
2025/12/28 下午 07:02,李冠葦,劉春燕,36,28,26,90
2025/12/28 下午 07:15,李冠葦,熊小蓮,36,27,27,90
2025/12/28 下午 07:41,李冠葦,陸廷瑋,0,0,0,0
2025/12/30 上午 04:05,羅如光,徐銘澤,37,27,26,90
2025/12/30 上午 04:04,羅如光,王元鼎,39,29,29,97
2025/12/30 上午 04:03,羅如光,林港博,39,29,29,97
2025/12/28 下午 08:27,曾婷婷,許芸嘉,36,30,28,94
2025/12/28 下午 09:57,李冠葦,林麗娟,37,26,29,92
2025/12/29 上午 01:34,王元鼎,羅如光,21,23,18,62
2025/12/28 下午 11:05,劉春燕,林紀騰,37,26,28,91
2025/12/28 下午 11:07,劉春燕,王芊蓉,38,30,29,97
2025/12/28 下午 11:08,劉春燕,李鳳翎,38,29,30,97
2025/12/28 下午 11:09,劉春燕,王元鼎,39,28,29,96
2025/12/28 下午 11:10,劉春燕,林港博,37,26,30,93
2025/12/28 下午 11:11,劉春燕,謝秀桃,32,22,20,74
2025/12/28 下午 11:12,劉春燕,熊小蓮,36,25,21,82
2025/12/28 下午 11:13,劉春燕,陸廷瑋,37,29,27,93
2025/12/28 下午 11:15,劉春燕,林麗娟,37,29,29,95
2025/12/28 下午 11:16,劉春燕,羅如光,33,25,27,85
2025/12/28 下午 11:18,劉春燕,徐銘澤,37,27,30,94
`;

        // 規則定義

        RAW_SCORE_CSV += `2025/12/29 上午 12:05,吳思函,吳秉熹,36,26,25,87
2025/12/29 上午 12:10,吳思函,蔣郡哲,36,25,25,86
2025/12/29 上午 12:12,吳思函,陳昱綸,35,25,25,85
2025/12/29 上午 12:14,吳思函,郭楷欣,35,25,25,85
2025/12/29 上午 12:15,吳思函,蘇盟惠,36,26,25,87
2025/12/29 上午 12:17,吳思函,劉宛宣,36,26,26,88
2025/12/29 上午 12:18,吳思函,黃穎蓁,35,25,25,85
2025/12/29 上午 12:19,吳思函,黃歆藝,34,25,25,84
2025/12/29 上午 12:21,吳思函,胡少淇,35,27,25,87
2025/12/29 上午 12:24,吳思函,劉婷瑜,37,26,27,90
2025/12/29 上午 12:42,林紀騰,徐銘澤,31,22,23,76
2025/12/29 上午 01:05,李鳳翎,王姿斐,40,29,28,97
2025/12/29 上午 01:10,李鳳翎,徐銘澤,36,25,27,88
2025/12/29 上午 01:11,李鳳翎,林麗娟,37,30,26,93
2025/12/29 上午 01:12,李鳳翎,陸廷瑋,38,25,29,92
2025/12/29 上午 01:15,李鳳翎,熊小蓮,36,28,27,91
2025/12/29 上午 01:17,李鳳翎,劉春燕,38,30,27,95
2025/12/29 上午 01:20,李鳳翎,羅如光,35,26,26,87
2025/12/29 上午 03:58,廖玟慈,林東美,36,26,27,89
2025/12/29 上午 03:47,廖玟慈,賀郁茵,35,24,24,83
2025/12/29 上午 03:48,廖玟慈,梁偉培,35,24,25,84
2025/12/29 上午 03:54,廖玟慈,張宜芳,30,22,24,76
2025/12/29 上午 03:51,廖玟慈,蕭婷予,32,23,23,78
2025/12/29 上午 03:52,廖玟慈,陳亮寧,32,20,23,75
2025/12/29 上午 03:53,廖玟慈,王卉蓁,32,24,23,79
2025/12/29 上午 03:54,廖玟慈,李炎輝,32,23,22,77
2025/12/29 上午 03:55,廖玟慈,許芸嘉,29,23,22,74
2025/12/29 上午 03:57,廖玟慈,曾婷婷,31,24,24,79
2025/12/30 下午 01:37,林品亨,黃穎蓁,35,24,26,85
2025/12/30 下午 01:39,林品亨,陳昱綸,35,25,25,85
2025/12/30 下午 01:36,林品亨,黃歆藝,34,25,24,83
2025/12/29 上午 09:36,劉婷瑜,郭楷欣,34,26,28,88
2025/12/29 上午 09:38,劉婷瑜,胡少淇,32,27,27,86
2025/12/29 上午 09:28,劉婷瑜,吳秉熹,34,26,28,88
2025/12/29 上午 09:29,劉婷瑜,蔣郡哲,37,27,26,90
2025/12/29 上午 09:30,劉婷瑜,吳思函,36,26,27,89
2025/12/29 上午 09:31,劉婷瑜,陳昱綸,35,27,25,87
2025/12/29 上午 09:32,劉婷瑜,蘇盟惠,37,26,28,91
2025/12/29 上午 09:34,劉婷瑜,劉宛宣,36,26,26,88
2025/12/29 上午 09:35,劉婷瑜,黃穎蓁,34,26,26,86
2025/12/29 上午 09:37,劉婷瑜,黃歆藝,34,28,26,88
2025/12/29 下午 04:34,熊小蓮,徐銘澤,36,26,28,90
2025/12/29 下午 07:11,梁偉培,林東美,40,30,29,99
2025/12/29 下午 07:12,梁偉培,賀郁茵,40,29,29,98
2025/12/29 下午 07:13,梁偉培,廖玟慈,39,30,30,99
2025/12/29 下午 07:14,梁偉培,張宜芳,37,27,26,90
2025/12/29 下午 07:15,梁偉培,蕭婷予,39,29,29,97
2025/12/29 下午 07:18,梁偉培,陳亮寧,40,27,29,96
2025/12/29 下午 07:19,梁偉培,王卉蓁,37,29,30,96
2025/12/29 下午 07:20,梁偉培,李炎輝,38,28,29,95
2025/12/29 下午 07:23,梁偉培,許芸嘉,39,29,28,96
2025/12/29 下午 07:26,梁偉培,曾婷婷,37,29,30,96
2025/12/29 下午 07:38,王元鼎,劉春燕,39,30,29,98
2025/12/29 下午 07:39,王元鼎,熊小蓮,37,30,27,94
2025/12/29 下午 07:40,王元鼎,陸廷瑋,39,30,30,99
2025/12/29 下午 07:41,王元鼎,林麗娟,37,29,29,95
2025/12/29 下午 07:43,王元鼎,徐銘澤,36,27,25,88
2025/12/29 下午 07:43,王元鼎,王姿斐,39,30,30,99
2025/12/29 下午 09:54,蘇盟惠,蔣郡哲,30,20,23,73
2025/12/29 下午 09:55,蘇盟惠,劉婷瑜,33,25,24,82
2025/12/29 下午 09:56,蘇盟惠,吳思函,34,23,24,81
2025/12/29 下午 09:59,蘇盟惠,陳昱綸,28,21,22,71
2025/12/29 下午 10:01,蘇盟惠,黃歆藝,33,24,21,78
2025/12/29 下午 10:03,蘇盟惠,黃穎蓁,32,22,21,75
2025/12/29 下午 10:51,簡采琦,廖玟慈,39,26,29,94
2025/12/29 下午 10:51,簡采琦,張宜芳,33,25,25,83
2025/12/29 下午 10:52,簡采琦,蕭婷予,34,25,24,83
2025/12/29 下午 10:52,簡采琦,陳亮寧,33,24,25,82
2025/12/29 下午 10:53,簡采琦,王卉蓁,36,25,25,86
2025/12/29 下午 10:53,簡采琦,李炎輝,33,25,25,83
2025/12/29 下午 10:54,簡采琦,許芸嘉,33,25,25,83
2025/12/29 下午 10:55,簡采琦,曾婷婷,36,27,27,90
2025/12/29 下午 11:24,陳淑錡,謝秀桃,20,20,20,60
2025/12/29 下午 11:28,陳淑錡,羅如光,22,20,21,63
2025/12/29 下午 11:28,張宜芳,林東美,38,25,27,90
2025/12/29 下午 11:29,張宜芳,賀郁茵,38,27,25,90
2025/12/29 下午 11:30,陳淑錡,劉春燕,35,29,26,90
2025/12/29 下午 11:29,張宜芳,梁偉培,36,25,25,86
2025/12/29 下午 11:30,張宜芳,廖玟慈,36,25,25,86
2025/12/29 下午 11:31,張宜芳,曾婷婷,36,25,25,86
2025/12/29 下午 11:32,張宜芳,蕭婷予,35,26,25,86
2025/12/29 下午 11:33,張宜芳,陳亮寧,36,24,25,85
2025/12/29 下午 11:34,張宜芳,王卉蓁,36,24,25,85
2025/12/29 下午 11:36,張宜芳,李炎輝,33,24,26,83
2025/12/29 下午 11:36,張宜芳,許芸嘉,35,25,25,85
2025/12/29 下午 11:38,陳淑錡,熊小蓮,31,24,26,81
2025/12/29 下午 11:40,陳淑錡,陸廷瑋,36,24,27,87
2025/12/29 下午 11:41,陳淑錡,林麗娟,29,26,26,81
2025/12/29 下午 11:42,陳淑錡,徐銘澤,33,25,23,81
2025/12/29 下午 11:43,陳淑錡,王姿斐,34,25,28,87
2025/12/30 上午 12:29,鍾宜珮,陳昱綸,32,23,25,80
2025/12/30 上午 01:46,王芊蓉,謝秀桃,28,23,21,72
2025/12/30 上午 01:54,王芊蓉,羅如光,32,24,24,80
2025/12/30 上午 01:47,王芊蓉,劉春燕,35,25,26,86
2025/12/30 上午 01:51,王芊蓉,熊小蓮,32,25,24,81
2025/12/30 上午 01:53,王芊蓉,陸廷瑋,34,23,25,82
2025/12/30 上午 01:47,王芊蓉,林麗娟,32,25,25,82
2025/12/30 上午 01:29,王芊蓉,徐銘澤,35,24,25,84
2025/12/30 上午 01:29,王芊蓉,王姿斐,36,25,25,86
2025/12/30 上午 03:57,羅如光,王芊蓉,39,29,29,97
2025/12/30 上午 03:32,羅如光,李鳳翎,39,29,27,95
2025/12/30 上午 04:02,羅如光,謝秀桃,19,18,20,57
2025/12/30 上午 03:58,羅如光,熊小蓮,36,27,27,90
2025/12/30 上午 03:59,羅如光,陸廷瑋,39,29,28,96
2025/12/30 上午 03:43,羅如光,林麗娟,37,29,27,93
2025/12/30 上午 04:00,羅如光,王姿斐,38,27,28,93
2025/12/30 上午 03:44,羅如光,劉春燕,39,27,30,96
2025/12/30 上午 08:18,陳宛妤,梁偉培,32,24,24,80
2025/12/30 上午 08:20,陳宛妤,廖玟慈,37,26,25,88
2025/12/30 下午 09:22,陳宛妤,張宜芳,32,24,24,80
2025/12/30 上午 08:31,陳宛妤,蕭婷予,32,25,23,80
2025/12/30 上午 08:35,陳宛妤,陳亮寧,34,22,24,80
2025/12/30 上午 08:55,陳宛妤,王卉蓁,35,23,25,83
2025/12/30 上午 10:27,賀郁茵,林東美,40,29,29,98
2025/12/30 上午 10:27,賀郁茵,梁偉培,40,26,28,94
2025/12/30 上午 10:28,賀郁茵,廖玟慈,40,28,26,94
2025/12/31 上午 07:46,賀郁茵,張宜芳,35,23,24,82
2025/12/30 上午 10:31,賀郁茵,蕭婷予,36,28,27,91
2025/12/30 上午 10:32,賀郁茵,陳亮寧,38,25,27,90
2025/12/30 上午 10:35,賀郁茵,王卉蓁,37,25,28,90
2025/12/30 上午 10:37,賀郁茵,李炎輝,35,25,25,85
2025/12/30 上午 10:47,賀郁茵,許芸嘉,38,25,25,88
2025/12/30 上午 10:48,賀郁茵,曾婷婷,40,26,26,92
2025/12/30 下午 02:28,謝秀桃,林港博,28,20,25,73
2025/12/30 下午 02:29,謝秀桃,劉春燕,28,20,25,73
2025/12/30 下午 02:30,謝秀桃,熊小蓮,28,20,25,73
2025/12/30 下午 02:31,謝秀桃,羅如光,28,20,25,73
2025/12/30 下午 02:32,謝秀桃,林麗娟,28,20,25,73
2025/12/30 下午 02:33,謝秀桃,陸廷瑋,28,20,25,73
2025/12/30 下午 02:35,謝秀桃,王姿斐,28,25,25,78
2025/12/30 下午 02:37,謝秀桃,王元鼎,28,25,25,78
2025/12/30 下午 02:37,謝秀桃,王芊蓉,28,25,25,78
2025/12/30 下午 02:38,謝秀桃,李鳳翎,28,25,25,78
2025/12/30 下午 02:39,謝秀桃,徐銘澤,32,25,25,82
2025/12/30 下午 06:50,許芸嘉,林東美,40,30,30,100
2025/12/30 下午 06:52,許芸嘉,賀郁茵,39,30,28,97
2025/12/30 下午 07:03,許芸嘉,梁偉培,37,29,29,95
2025/12/30 下午 06:55,許芸嘉,廖玟慈,40,30,30,100
2025/12/30 下午 06:57,許芸嘉,張宜芳,33,28,30,91
2025/12/30 下午 06:59,許芸嘉,蕭婷予,38,30,29,97
2025/12/30 下午 07:03,許芸嘉,陳亮寧,38,27,29,94
2025/12/30 下午 07:02,許芸嘉,王卉蓁,39,30,29,98
2025/12/30 下午 07:05,許芸嘉,李炎輝,35,27,29,91
2025/12/30 下午 07:05,許芸嘉,曾婷婷,39,29,29,97
2025/12/30 下午 09:21,黃穎蓁,蘇盟惠,32,22,26,80
2025/12/30 下午 09:22,黃穎蓁,吳思函,34,22,25,81
2025/12/30 下午 09:24,陳宛妤,李炎輝,34,24,22,80
2025/12/30 下午 09:23,黃穎蓁,劉婷瑜,34,24,25,83
2025/12/30 下午 09:26,黃穎蓁,蔣郡哲,31,22,24,77
2025/12/30 下午 09:28,黃穎蓁,吳秉熹,34,23,24,81
2025/12/30 下午 09:30,黃穎蓁,胡少淇,28,23,24,75
2025/12/30 下午 09:32,黃穎蓁,郭楷欣,32,23,24,79
2025/12/30 下午 09:34,黃穎蓁,陳昱綸,33,24,23,80
2025/12/30 下午 10:02,陳宛妤,許芸嘉,31,21,23,75
2025/12/30 下午 10:04,陳宛妤,曾婷婷,34,25,24,83
2025/12/30 下午 11:08,林麗娟,李鳳翎,36,28,28,92
2025/12/30 下午 11:09,林麗娟,王元鼎,38,25,28,91
2025/12/30 下午 11:05,林麗娟,王姿斐,37,25,28,90
2025/12/30 下午 11:08,林麗娟,徐銘澤,36,26,26,88
2025/12/30 下午 11:15,林麗娟,陸廷瑋,35,25,28,88
2025/12/30 下午 11:18,林麗娟,王芊蓉,36,27,25,88
2025/12/31 上午 12:09,林麗娟,林紀騰,35,25,26,86
2025/12/31 上午 12:34,徐銘澤,王芊蓉,33,28,26,87
2025/12/30 下午 11:44,廖振杉,梁偉培,30,25,23,78
2025/12/30 下午 11:46,廖振杉,廖玟慈,36,25,25,86
2025/12/30 下午 11:46,廖振杉,張宜芳,32,25,21,78
2025/12/30 下午 11:47,廖振杉,蕭婷予,33,24,22,79
2025/12/30 下午 11:48,廖振杉,陳亮寧,33,23,21,77
2025/12/30 下午 11:49,廖振杉,王卉蓁,36,24,21,81
2025/12/30 下午 11:50,廖振杉,李炎輝,33,22,25,80
2025/12/30 下午 11:51,廖振杉,許芸嘉,35,25,21,81
2025/12/30 下午 11:52,廖振杉,曾婷婷,34,24,22,80
2025/12/31 上午 12:01,徐銘澤,李鳳翎,34,26,26,86
2025/12/30 下午 11:59,廖振杉,熊小蓮,35,25,23,83
2025/12/31 上午 12:03,徐銘澤,王元鼎,36,25,27,88
2025/12/31 上午 06:42,徐銘澤,林港博,34,26,26,86
2025/12/31 上午 12:10,徐銘澤,謝秀桃,28,22,25,75
2025/12/31 上午 12:11,林麗娟,林港博,36,24,25,85
2025/12/31 上午 12:13,徐銘澤,羅如光,28,21,21,70
2025/12/31 上午 12:12,林麗娟,劉春燕,36,25,26,87
2025/12/31 上午 12:15,林麗娟,熊小蓮,36,25,25,86
2025/12/31 上午 12:16,徐銘澤,劉春燕,32,26,23,81
2025/12/31 上午 12:18,林麗娟,謝秀桃,34,25,24,83
2025/12/31 上午 12:19,徐銘澤,熊小蓮,32,26,22,80
2025/12/31 上午 12:20,林麗娟,羅如光,36,25,24,85
2025/12/31 上午 12:28,徐銘澤,陸廷瑋,36,24,26,86
2025/12/31 上午 12:29,徐銘澤,林麗娟,33,25,25,83
2025/12/31 上午 12:28,徐銘澤,王姿斐,35,25,26,86
2025/12/31 上午 05:32,林港博,徐銘澤,0,0,0,0
2025/12/31 上午 05:35,林港博,徐銘澤,35,24,25,84
2025/12/27 上午 01:28,廖慧雯,鍾宜珮,35,29,26,90
2025/12/27 上午 01:30,廖慧雯,林品亨,34,22,23,79
2025/12/27 上午 01:34,廖慧雯,高靜華,34,26,26,86
2025/12/27 上午 02:09,鍾宜珮,林品亨,26,20,24,70
2025/12/28 上午 02:37,李冠葦,陳淑錡,32,29,25,86
2025/12/28 下午 10:45,李冠葦,林紀騰,32,23,26,81
2025/12/28 下午 11:04,李冠葦,高靜華,30,27,25,82
2025/12/28 下午 11:11,李冠葦,白梅芳,0,0,0,0
2025/12/30 上午 12:29,陳淑錡,林紀騰,20,16,16,52
2025/12/31 上午 12:02,廖振杉,高靜華,34,24,25,83
2025/12/31 上午 01:14,廖振杉,白梅芳,32,28,26,86
2025/12/31 上午 01:17,廖振杉,簡采琦,33,25,27,85
2025/12/31 上午 01:18,廖振杉,陳宛妤,35,26,26,87
2025/12/31 上午 01:25,陳宛妤,簡采琦,34,28,27,89`;
        1: "基金會總幹事：董事長50% + 行政組專職50%",
            2: "家園主任：董事長50% + 該家園教保組50%",
                3: "諮商所所長：董事長50% + 諮商所專職50%",
                    4: "單位主管(含副組長)：機構主管50% + 組內50%",
                        5: "圖書教育組長：總幹事+家園主任 100%",
                            6: "家園督導：主管50% + 該股股員40% + 其他該組10%",
                                7: "行政組股長：主管50% + 該股股員30% + 其他該組20%",
                                    8: "行政組員工：主管50% + 其他該組50%",
                                        9: "社資組員工：主管50% + 行政組50%",
                                            10: "兒少之家社工/心理師：主管50% + 其他該組及心理師50%",
                                                11: "少年家園社工/心輔：主管50% + 其他該組50%",
                                                    12: "諮商所員工：主管50% + 該所員工50%",
                                                        13: "保育/生輔員工：主管50% + 其他該組及心理師50%",
                                                            0: "未知規則"
        };

        // 解析 CSV
        function parseCSV(csv) {
            const lines = csv.trim().split('\n');
            const headers = lines[0].split(',').map(h => h.trim());
            return lines.slice(1).map(line => {
                const values = line.split(',');
                const obj = {};
                headers.forEach((h, i) => obj[h] = values[i] ? values[i].trim() : '');
                return obj;
            });
        }

        // 主邏輯
        function init() {
            if (RAW_PERSONNEL_CSV.includes("PLACEHOLDER")) return; // 防止未注入資料時報錯

            const personnel = parseCSV(RAW_PERSONNEL_CSV);
            const scores = parseCSV(RAW_SCORE_CSV);

            // 整理人員資料 Map
            const empMap = {};
            const unitGroups = {}; // 用於快速查找同組人員

            personnel.forEach(p => {
                const name = p['員工姓名'];
                empMap[name] = p;

                // 建立群組索引 (用於查找 "同組員工")
                const key = `${p['所屬機構']}_${p['所屬單位']}_${p['股別']}`;
                if (!unitGroups[key]) unitGroups[key] = [];
                unitGroups[key].push(name);

                // 較寬鬆的組別 (不分股)
                const broadKey = `${p['所屬機構']}_${p['所屬單位']}`;
                if (!unitGroups[broadKey]) unitGroups[broadKey] = [];
                unitGroups[broadKey].push(name);
            });

            // 整理評分資料：誰評了誰 -> 分數物件
            // 結構: scoreDetails[受評者][評分者] = { cat1, cat2, cat3, total }
            const scoreData = {};
            scores.forEach(s => {
                const target = s['受評者'];
                const rater = s['評分者'];
                if (!scoreData[target]) scoreData[target] = {};

                // 處理重複評分：取最新或平均？這裡假設取最後一筆 (或根據需求)
                // 考慮到 csv可能有重複，這裡簡單覆蓋
                scoreData[target][rater] = {
                    cat1: parseFloat(s['第一大類（共40分）']) || 0,
                    cat2: parseFloat(s['第二大類（共30分）']) || 0,
                    cat3: parseFloat(s['第三大類（共30分）']) || 0,
                    total: parseFloat(s['總分']) || 0
                };
            });

            // 計算每個人員的結果
            const results = personnel.map(p => calculateScore(p, empMap, unitGroups, scoreData));

            renderTabs(results);
            renderTable('all', results);

            // 存入全域變數供切換使用
            window.allResults = results;
        }

        // 核心計算函數
        function calculateScore(person, empMap, unitGroups, scoreData) {
            const name = person['員工姓名'];
            const title = person['職稱'];
            const unit = person['所屬單位'];
            const subUnit = person['股別'];
            const myScores = scoreData[name] || {};

            let ruleId = 0;
            let finalScores = { cat1: 0, cat2: 0, cat3: 0, total: 0 };
            let log = [];

            // 定義輔助函數：計算一群評分者的平均分
            const getAvg = (raterNames, weight) => {
                let validRaters = 0;
                let sums = { c1: 0, c2: 0, c3: 0 };

                const uniqueRaters = [...new Set(raterNames)].filter(r => r !== name); // 排除自己

                uniqueRaters.forEach(r => {
                    if (myScores[r]) {
                        validRaters++;
                        sums.c1 += myScores[r].cat1;
                        sums.c2 += myScores[r].cat2;
                        sums.c3 += myScores[r].cat3;
                    }
                });

                if (validRaters === 0) {
                    log.push(`缺: ${weight * 100}% 來源 (${uniqueRaters.join(',') || '無名單'})`);
                    return { c1: 0, c2: 0, c3: 0, w: 0 };
                }

                log.push(`有: ${weight * 100}% 來源 (${validRaters}人: ${uniqueRaters.filter(r => myScores[r]).join(',')})`);

                return {
                    c1: (sums.c1 / validRaters) * weight,
                    c2: (sums.c2 / validRaters) * weight,
                    c3: (sums.c3 / validRaters) * weight,
                    w: weight // 實際有吃到的權重
                };
            };

            // 查找特定角色
            const findByTitle = (t) => Object.values(empMap).filter(e => e['職稱'] === t).map(e => e['員工姓名']);
            const findByUnit = (u) => Object.values(empMap).filter(e => e['所屬單位'] === u).map(e => e['員工姓名']);

            // 規則判斷邏輯
            if (title === '總幹事') {
                ruleId = 1;
                // 董事長 50% (假設評分者叫 '董事長' 或名冊中標註，這裡暫時寫死或需確認誰是董事長)
                // 從名冊看，董事長並不在員工名單? 查看 score.csv 發現沒有「董事長」這個評分者，但可能有名字。
                // 根據規則，我們先假設直屬主管欄位的人就是評分者
                const bossName = person['直屬主管'] || '董事長';

                // 行政組專職
                const adminStaff = unitGroups['基金會_行政組'] || [];

                let p1 = getAvg([bossName], 0.5);
                let p2 = getAvg(adminStaff, 0.5);
                addWeighted(finalScores, p1, p2);

            } else if (title === '主任') {
                ruleId = 2;
                const bossName = person['直屬主管']; // 董事長
                // 該家園教保組
                // 需區分兒少之家或少年家園
                const org = person['所屬機構'] === '-' ? person['所屬單位'] : person['所屬機構']; // 處理csv資料格式
                // 其實可以用 所屬單位 判斷 (兒少之家 / 少年家園)
                // 注意 CSV 中 兒少之家 的機構是 '-'
                let targetGroupKey = '';
                if (name === '廖振杉') targetGroupKey = '-_兒少之家_教保組'; // 需確認CSV結構
                // 修正：直接搜所有該機構教保組的人
                // 根據名冊：
                // 廖振杉(兒少之家 主任) -> 兒少之家教保組
                // 廖慧雯(少年家園 主任) -> 少年家園教保組

                // 這裡簡化邏輯：用filter
                const myOrg = person['所屬機構'] === '-' ? person['所屬單位'] : person['所屬機構']; // e.g., 兒少之家
                const staff = Object.values(empMap).filter(e => {
                    const eOrg = e['所屬機構'] === '-' ? e['所屬單位'] : e['所屬機構'];
                    return eOrg === myOrg && e['所屬單位'] === '教保組';
                }).map(e => e['員工姓名']);

                let p1 = getAvg([bossName], 0.5);
                let p2 = getAvg(staff, 0.5);
                addWeighted(finalScores, p1, p2);

            } else if (title === '所長') {
                ruleId = 3;
                const bossName = person['直屬主管'];
                const staff = findByUnit('諮商所');
                let p1 = getAvg([bossName], 0.5);
                let p2 = getAvg(staff, 0.5);
                addWeighted(finalScores, p1, p2);

            } else if (title === '組長' || title === '副組長') {
                // 需區分 Rule 4 (主管) 或 Rule 5 (圖書)
                if (unit === '圖書組') {
                    ruleId = 5;
                    // 總幹事 + 家園主任(廖振杉、廖慧雯)
                    let raters = ['李冠葦', '廖振杉', '廖慧雯']; // 李冠葦是總幹事
                    let p1 = getAvg(raters, 1.0);
                    addWeighted(finalScores, p1);
                } else {
                    ruleId = 4;
                    const bossName = person['直屬主管'];
                    // 組內員工
                    // 行政組長 -> 行政組全員
                    // 兒家教保組長 -> 兒家教保組全員
                    const myOrg = person['所屬機構'];
                    const myUnit = person['所屬單位'];
                    const staff = Object.values(empMap).filter(e =>
                        e['所屬機構'] === myOrg && e['所屬單位'] === myUnit
                    ).map(e => e['員工姓名']);

                    let p1 = getAvg([bossName], 0.5);
                    let p2 = getAvg(staff, 0.5);
                    addWeighted(finalScores, p1, p2);
                }

            } else if (person['職稱'].includes('督導')) { // 包含'社工督導', '生輔督導'
                ruleId = 6;
                // Rule 6: 主管50% + 該股40% + 其他該組10%
                const bossName = person['直屬主管'];

                // 該股
                const myGroupKey = `${person['所屬機構']}_${person['所屬單位']}_${person['股別']}`;
                const myGroupStaff = unitGroups[myGroupKey] || [];

                // 該組其他 (同單位 但 不同股)
                const myUnitKey = `${person['所屬機構']}_${person['所屬單位']}`;
                const allUnitStaff = unitGroups[myUnitKey] || [];
                const otherStaff = allUnitStaff.filter(n => !myGroupStaff.includes(n));

                let p1 = getAvg([bossName], 0.5);
                let p2 = getAvg(myGroupStaff, 0.4);
                let p3 = getAvg(otherStaff, 0.1);
                addWeighted(finalScores, p1, p2, p3);

            } else if (title === '股長') { // 行政組股長
                ruleId = 7;
                const bossName = person['直屬主管'];

                // 該股
                const myGroupKey = `${person['所屬機構']}_${person['所屬單位']}_${person['股別']}`;
                const myGroupStaff = unitGroups[myGroupKey] || [];

                // 該組其他
                const myUnitKey = `${person['所屬機構']}_${person['所屬單位']}`;
                const allUnitStaff = unitGroups[myUnitKey] || [];
                const otherStaff = allUnitStaff.filter(n => !myGroupStaff.includes(n));

                let p1 = getAvg([bossName], 0.5);
                let p2 = getAvg(myGroupStaff, 0.3);
                let p3 = getAvg(otherStaff, 0.2);
                addWeighted(finalScores, p1, p2, p3);

            } else {
                // 一般員工與資深員工的判斷
                // 需依據單位判斷規則 8~13
                const fullUnit = `${person['所屬機構']}${person['所屬單位']}`;

                if (fullUnit.includes('基金會行政組')) {
                    ruleId = 8;
                    // Rule 8: 主管50% + 其他該組員工50%
                    const bossName = person['直屬主管'];
                    const myUnitKey = `${person['所屬機構']}_${person['所屬單位']}`; // 連機構一起看比較準
                    const staff = unitGroups[myUnitKey] || [];

                    let p1 = getAvg([bossName], 0.5);
                    let p2 = getAvg(staff, 0.5);
                    addWeighted(finalScores, p1, p2);

                } else if (fullUnit.includes('社資組')) {
                    ruleId = 9;
                    const bossName = person['直屬主管'];
                    // 行政組員工 (基金會行政組)
                    const adminStaff = Object.values(empMap).filter(e =>
                        e['所屬機構'] === '基金會' && e['所屬單位'] === '行政組'
                    ).map(e => e['員工姓名']);

                    let p1 = getAvg([bossName], 0.5);
                    let p2 = getAvg(adminStaff, 0.5);
                    addWeighted(finalScores, p1, p2);

                } else if (fullUnit.includes('諮商所')) {
                    ruleId = 12;
                    const bossName = person['直屬主管'];
                    const staff = findByUnit('諮商所');
                    let p1 = getAvg([bossName], 0.5);
                    let p2 = getAvg(staff, 0.5);
                    addWeighted(finalScores, p1, p2);

                } else if (person['所屬單位'] === '教保組') {
                    // 這裡比較複雜，分兒少/少年，分社工/生輔
                    if (person['所屬機構'].includes('兒少') && person['股別'].includes('社工')) {
                        ruleId = 10;
                    } else if (person['所屬機構'].includes('少年') && person['股別'].includes('社工')) {
                        ruleId = 11;
                    } else {
                        // 保育/生輔
                        ruleId = 13;
                    }

                    // Rules 10, 11, 13 結構都是 主管50% + 該組(含心理師/社工) 50%
                    // 基本上就是同單位互評
                    // 注意 Rule 10, 13 提到 "及心理師"， Rule 11 是 "該組員工"
                    // 簡單處理：都是 "同教保組所有人" 互評
                    const bossName = person['直屬主管'];
                    const myUnitKey = `${person['所屬機構']}_${person['所屬單位']}`;
                    let staff = unitGroups[myUnitKey] || [];

                    // 特殊處理：如果是兒少之家，可能要包含心理師？
                    // 暫時以同單位為準

                    let p1 = getAvg([bossName], 0.5);
                    let p2 = getAvg(staff, 0.5);
                    addWeighted(finalScores, p1, p2);
                } else {
                    // 預設規則 (Fallback)
                    ruleId = 0;
                    const bossName = person['直屬主管'];
                    let p1 = getAvg([bossName], 1.0);
                    addWeighted(finalScores, p1);
                }
            }

            return {
                ...person,
                scores: finalScores,
                ruleId: ruleId,
                log: log,
                hasData: Object.keys(myScores).length > 0
            };
        }

        // 輔助：累加分數
        function addWeighted(target, ...parts) {
            // 檢查權重是否滿 100% (normalize if needed, but keeping exact for now)
            // 如果某部分缺資料(w=0)，是否要歸一化？
            // 根據一般考績邏輯，若某來源從缺，通常配分會移轉或直接扣除。
            // 這裡採取：若有部分來源，則依比例放大？不，現在直接加總，顯示 "缺" 在 log 中。

            // 修正邏輯：如果 p1 缺了，總分就會少。
            // 為了方便檢視，如果缺了，分數會偏低，但 log 會顯示。

            // 進階：如果有部分資料存在，依「實際存在權重」重新歸一化？
            // 例如：應為 50%+50%，結果第二個50%沒人評。
            // 選項A: 分數只剩一半。
            // 選項B: 第一個50% 變成 100%。
            // 現行作法：選項A，由使用者自行判斷是否補評。

            parts.forEach(p => {
                target.cat1 += p.c1;
                target.cat2 += p.c2;
                target.cat3 += p.c3;
            });
            target.total = target.cat1 + target.cat2 + target.cat3;
        }

        // 渲染 Tab
        function renderTabs(results) {
            const units = [...new Set(results.map(r => r['所屬單位']))];
            const html = `<button class="tab active" onclick="renderTable('all')">全部總覽</button>` +
                units.map(u => `<button class="tab" onclick="renderTable('${u}')">${u}</button>`).join('');
            document.getElementById('unitTabs').innerHTML = html;
        }

        // 渲染表格
        function renderTable(filterUnit, data = window.allResults) {
            // Update tabs active state
            document.querySelectorAll('.tab').forEach(b => {
                if (b.textContent === filterUnit || (filterUnit === 'all' && b.textContent === '全部總覽')) {
                    b.classList.add('active');
                } else {
                    b.classList.remove('active');
                }
            });

            const tbody = document.getElementById('tableBody');
            const filtered = filterUnit === 'all' ? data : data.filter(r => r['所屬單位'] === filterUnit);

            tbody.innerHTML = filtered.map(r => `
                <tr>
                    <td>${r['所屬機構']} ${r['所屬單位']}</td>
                    <td><strong>${r['員工姓名']}</strong></td>
                    <td><span class="tag ${getRoleClass(r['職稱'])}">${r['職稱']}</span> ${r['股別']}</td>
                    <td>
                        <div style="font-weight:bold;">Rule ${r.ruleId}</div>
                        <div class="rule-info">${RULES[r.ruleId]}</div>
                    </td>
                    <td>
                         ${r.log.map(l => `<div style="font-size:0.85em; ${l.includes('缺') ? 'color:#ff6b6b;' : 'color:#74c0fc;'}">${l}</div>`).join('')}
                    </td>
                    <td><span class="category-score">${r.scores.cat1.toFixed(1)}</span></td>
                    <td><span class="category-score">${r.scores.cat2.toFixed(1)}</span></td>
                    <td><span class="category-score">${r.scores.cat3.toFixed(1)}</span></td>
                    <td><span class="total-score">${r.scores.total.toFixed(1)}</span></td>
                </tr>
            `).join('');
        }

        function getRoleClass(title) {
            if (title.includes('主管') || title.includes('長') || title.includes('主任')) return 'role-mgr';
            if (title.includes('資深')) return 'role-senior';
            return 'role-gen';
        }

        // 啟動
        setTimeout(init, 500);
    </script>
</body>

</html>